<!DOCTYPE html>
<html>
  <head>
    <title>Title</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      html { font-size: 18px; }

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }

      .example-wrapper {
        display: flex;
        align-items: center;
      }

      .example {
        flex-grow: 1;
        flex-shrink: 0;
        font-family: 'Yanone Kaffeesatz';
        font-size: 2rem;
        color: #fff;
        text-align: center;
      }
      .example:not(:last-child) { margin-right: 1rem; }

      .a2 { flex-grow: 2; }
      .b2 { flex-grow: 1; }
      .c2 { flex-grow: 2; }

      .a { background-color: red;   }
      .b { background-color: blue;  }
      .c { background-color: green; }

      .avatar {
        height: 100%;
        width: 6rem;
        border-radius: 0.2rem;
        /*border: 3px solid #131313;*/
      }

      .btn {
        flex: 1;
        text-align: center;
        padding-top: 0.5rem;
        padding-bottom: 0.5rem;
        border-radius: 2px;
      }

      .btn:not(:first-child) { margin-left: 1rem; }

      .btn-normal {
        color: #171717;
        background-color: #b8b8b8;
        border-color: #595959;
      }

      .btn-error {
        color: #fff;
        background-color: #e80000;
        border-color: #6a0000;
      }

      .btn-disabled {
        color: #b8b8b8;
        background-color: #777777;
        font-style: italic;
        border-color: #595959;
      }

      .submit-button {
        font-size: 2rem;
        color: #fff;
        background-color: #df0070;
      }

      .rows {
        flex-flow: column;
      }

      .rows .btn {
        width: 50%;
        margin-bottom: 1rem;
      }

      .rows .btn:not(:first-child) { margin-left: 0;}
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Designing Components with React & CSSModules

### Chris Keathley / @ChrisKeathley / keathley.io

---

class: center, middle

# Fatigue

???

- No reason to feel this way!!!
- Less about tools and more about FOMO and insecurity
- Not telling you that what you are doing is wrong or bad.
- Tools are secondary to ideas. We need to think about tradeoffs with tools
- This is about an idea. I use these things because they help me reach my goals.
- You should stick to tools that help you achieve your goals. If that happens
to be some of the stuff that we talk about here then that works out.

---

# What are we gunna talk about?

--

- Why Components?
--

- React
--

- CSSModules
--

- Webpack
--

- PostCSS

???

- We aren't going to say anything about flux
- This is really more about an idea then anything
- Some of this I'm still working on.

---

class: center, middle

# Why components?

???

I had been doing a lot of front end development with tools like Angular and
Sass. Lots of Rails. I was getting really diss-satisfied with my workflow. I
was trying to figure out how to get more re-use out of my styles.

I was also frustrated trying to make changes in my templates that were in most
cases hard coupled to my controller or directive. I was having tons of trouble with data binding.

I think there are 2 problems here

---

class: center, middle

# Problem 1: The separation of concerns is wrong

---

class: center, middle

# What if you were doing TDD?

???

Think about this in terms of testing. If you want to test a controller then you
need to provide a double of the html, or the html itself in order you to fully
exercise the controller. If you have to click DOM elements then test some state
elsewhere...well in a TDD/BDD world that would tell you that you've separated
things incorrectly.

---

class: center, middle

# "What if the DOM was just AST"

???

I was talking to my friend one night and I said, "What if the DOM was just an AST"
You could hold onto some state and then just every clock tick just evaluate the
AST". You would get all sorts of interactivity for free, you could compose AST
fragments together, etc. I thought that this would be a great way to avoid
dealing with all of the difficulties in re-use and data binding that I was having.

---

class: center, middle

# "Dude have you seen React?"

???

Changed my life like Jesus. Never really looked back.

---

class: center, middle

# Your app is built out of components

---

background-image: url("stickies.png")

---

# Directory structure

```js
|-components
  |-avatar
    |-Avatar.jsx
```

---

# Avatar component

``` js
import React from 'react'

export const Avatar = ({ src, name }) => (
  <img className="avatar" src={ src } title={ name } />
)
```

.example-wrapper[
  .img[<img src="ernie.jpg" class="avatar"></img>]]

---

# Directory structure

``` js
|-components
  |-avatar
    |- Avatar.jsx
  |- CardAuthors.jsx
```

---

# CardAuthors Component

``` js
import React from 'react'
import { Avatar } from './avatar/Avatar.jsx'

export const CardAuthors = React.createClass({
  getInitialState() {
    return {
      authors: [
        {userId: 1, avatar_url: 'example.com/1.png', name: 'Chris'}
      , {userId: 2, avatar_url: 'example.com/2.png', name: 'Alice'}
      , {userId: 3, avatar_url: 'example.com/3.png', name: 'Archer'}
      ]
    }
  }

, render() {
    let avatars = this.state.authors.map( author => (
      <Avatar key={author.userId} src={author.avatar_url} name={author.name} />
    ))

    return (
      <div>
        { avatars }
      </div>
    )
  }
})
```

---

class: center, middle

# Problem 2: Styles are hard to maintain

---

# Why is this hard?

--

- The box model
--

- Global scope
--

- Encapsulation is hard
--

- Styles are coupled to your html structure
--

- Browsers

???

I personally this is hard for the same reasons that I think OO is hard. We're
bad at scoping and segmenting things. The problem is made worse by the fact that
CSS isn't really tested. It also has global scope. Which means that anything
from anywhere can mutate that global scope.

---

class: center, middle

# CSS has gotten a lot better

---

class: center, middle

# Flexbox

---

# Flexbox

``` css
.example-wrapper { display: flex; }

.example {
  flex-grow: 1;
  flex-shrink: 0;
}

.a { background-color: red;  }
.b { background-color: blue; }
```

.example-wrapper[
  .example.a[A]
  .example.b[B]]

---

# Flexbox

``` css
.example-wrapper { display: flex; }

.example {
  flex-grow: 1;
  flex-shrink: 0;
}

.a {
  flex-grow: 2;
  background-color: red;
}

.b {
  flex-grow: 1;
  background-color: blue;
}
```

.example-wrapper[
  .example.a.a2[A]
  .example.b.b2[B]]

---

# Flexbox

``` css
.example-wrapper { display: flex; }

.example {
  flex-grow: 1;
  flex-shrink: 0;
}
.example:not(:last-child) { margin-right: 1rem; }

.a {
  flex-grow: 2;
  background-color: red;
}

.b {
  flex-grow: 1;
  background-color: blue;
}

.c {
  flex-grow: 2;
  background-color: green;
}
```

.example-wrapper[
  .example.a.a2[A]
  .example.b.b2[B]
  .example.c.c2[C]]

---

class: center, middle

# Global Scope

---

# Global Scope

``` css
.text {
  font-size: 1rem;
  font-weight: 200;
}

.footer {
  width: 100%;
  height: 4rem;
  background-color: blue;
}

.card {
  width: 15rem;
}
```

``` js
<div class="card">
  <p class="text">
    This is some content
  </p>
  <div class="footer">
    <p class="text">
      This is the footer
    </p>
  </div>
</div>
```

---

# Global Scope

``` css
.card-text {
  font-size: 1rem;
  font-weight: 200;
}

.card-footer {
  width: 100%;
  height: 4rem;
  background-color: blue;
}

.card {
  width: 15rem;
}
```

``` js
<div class="card">
  <p class="card-text">
    This is some content
  </p>
  <div class="card-footer">
    <p class="card-text">
      This is the footer
    </p>
  </div>
</div>
```

---

class: center, middle

# Methodology

---

class: center, middle

# Atomic Design

---

class: center, middle

# Smacss

---

class: center, middle

# OOCSS

---

class: center, middle

# BEM

---

# Avoiding global scope

```css
.btn { /* all styles for Normal */ }
.btn--disabled { /* overrides for Disabled */ }
.btn--error { /* overrides for Error */ }
.btn--in-progress { /* overrides for In Progress */
```

---

class: center, middle

# CSS Modules

---

# Traditional CSS

```css
.btn { /* all styles for Normal */ }
.btn--disabled { /* overrides for Disabled */ }
.btn--error { /* overrides for Error */ }
.btn--in-progress { /* overrides for In Progress */
```

``` js
export const Button = ({disabled}) => {
  let classes = classNames('btn', {'btn--disabled': disabled})

  return (
    <button class={classes} role="button">
      Push me
    </button>
  )
}
```

.example-wrapper[
  .btn.btn-normal[Normal]
  .btn.btn-disabled[Disabled]
  .btn.btn-error[Error]]

???

Traditionally we would do something like this for styling specific pieces of
our application.

---

# With CSS Modules

``` css
/* shared/button.css */
.normal { /* all styles for Normal */ }
.disabled { /* all styles for Disabled */ }
.error { /* all styles for Error */ }
.in-progress { /* all styles for In Progress */
```

``` js
import styles from "./button.css"

export const Button = ({disabled}) => {
  let className = disabled ? styles.disabled : styles.normal

  return (
    <button class={className} role="button">
      Push me
    </button>
  )
}
```
.example-wrapper[
  .btn.btn-normal[Normal]
  .btn.btn-disabled[Disabled]
  .btn.btn-error[Error]]

???

Now we just include what we want with the styles. This is SO much better.
The alternative is just to use a weak naming connascence instead. OR we could
just like...use the thing man.

---

# Composition is everything

``` css
/* shared/button.css */

.common {
  /* Base button styles */
}

.normal {
  composes: common;

  /* any other normal styles */
}

.disabled {
  composes: common;

  /* any disabled styles */
}
```

---

``` css
/* shared/button.css */

.common {
  /* Base button styles */
}

.normal {
  composes: common;
  composes: primary from "./font.css";
  composes: primary from "./background.css";
}

.disabled {
  composes: common;
  composes: subtle from "./font.css";
  composes: subtle from "./background.css";
}
```

``` css
/* shared/font.css */
.primary { color: #0e0e0e; }
.subtle  { color: #b3b3b3; }
```

``` css
/* shared/background.css */
.primary { background-color: #c200ba; }
.subtle  { background-color: #d4d4d4; }
```

---

``` css
/* shared/button.css */

.common {
  composes: bold medium from "./fonts.css"
  /* Other common styles */
}

.normal {
  composes: common;
  composes: primary from "./font.css";
  composes: primary from "./background.css";
}

.disabled {
  composes: common;
  composes: subtle from "./font.css";
  composes: subtle from "./background.css";
}
```

``` css
/* shared/font.css */
.primary { color: #0e0e0e; }
.subtle  { color: #b3b3b3; }

.bold   { font-weight: 600; }
.normal { font-weight: 400; }
.light  { font-weight: 200; }

.small  { font-size: 0.8rem; }
.medium { font-size: 1rem; }
.large  { font-size: 1.2rem; }
```

---

# Get more re-use

``` js
import React from 'react'
import styles from './button.css'

export const Button = ({state, text}) => (
  <button role="button" className={styles[state]}>
    {text}
  </button>
)

<Button state="error" text="Error" />
<Button state="normal" text="Normal" />
<Button state="in-progress" text="In-Progress" />
```

.example-wrapper[
  .btn.btn-normal[Normal]
  .btn.btn-disabled[Disabled]
  .btn.btn-error[Error]]

---

# Get more re-use

``` js
import React from 'react'
import { submit } from './submit_button.css'

export const Button = ({text}) => (
  <button role="submit" className={ submit }>
    {text ? text : "Submit"}
  </button>
)
```

``` css
.submit {
  composes: primary from "../shared/button.css";
  composes: uppercase from "../shared/font.css";
}
```

.example-wrapper[
  .btn.submit-button[Submit]]

---

# Co-locate styles

``` js
|-components
  |-avatar
    |- Avatar.jsx
    |- avatar.css
  |-shared
    |- background.css
    |- border.css
    |- font.css
    |- layout.css
  |- CardAuthors.jsx
```

---

# Stateful components use layout styles

``` js
import React from 'react'
import { Button } from './shared/Button.jsx'
import { flex } from './shared/layout.css'

export const ButtonContainer = React.createClass({
  render() {
    return (
      <div className={ flex }>
        <Button state='normal' text="Normal" />
        <Button state='error' text="Error" />
        <Button state='disabled' text="Disabled" />
      </div>
    )
  }
})
```

.example-wrapper.cols[
  .btn.btn-normal[Normal]
  .btn.btn-error[Error]
  .btn.btn-disabled[Disabled]]

---

# Stateful components use layout styles

``` js
import React from 'react'
import classNames from 'classnames'
import { Button } from './shared/Button.jsx'
import { flex, rows } from './shared/layout.css'

export const ButtonContainer = React.createClass({
  render() {
    return (
      <div className={ classNames(flex, rows) }>
        <Button state='normal' text="Normal" />
        <Button state='error' text="Error" />
        <Button state='disabled' text="Disabled" />
      </div>
    )
  }
})
```

.example-wrapper.rows[
  .btn.btn-normal[Normal]
  .btn.btn-error[Error]
  .btn.btn-disabled[Disabled]]
---

class: center, middle

# How do we actually do this?

---

class: center, middle

# Webpack

---

# Webpack

- Allows loading of multiple types of files
--

- Code splitting
--

- Chunking and optimizations
--

- NPM modules
--

- Hot code reloading

???

Webpack is definitely a difficult tool. But there are a lot of good reasons to
check it out.

---

class: center, middle

# Loaders and pipelines

---

# Loaders and pipelines

``` js
module.exports = {
  // ...

, module: {
    loaders: [
      { test: /\.jsx?$/, loaders: [ 'babel' ], exclude: /node_modules/ }
    , { test: /\.css$/, loader: 'style!css?modules!postcss' }
    ]
  }

, postcss: function() {
    return [
        values
      , postcss_nested
      , postcss_color
      , autoprefixer
      , mqpacker
      , csswring
    ]
  }

  //...
};
```

---

# React Loader

``` js
{ test: /\.jsx?$/, loaders: [ 'babel' ], exclude: /node_modules/ }
```

???

We just use babel here to compile our jsx

---

# CSS Loader

``` js
{ test: /\.css$/, loader: 'style!css?modules!postcss' }
```

???

Using the CSS loader we can enable css modules in webpack.

---

class: center, middle

# Post css

???

Who is familiar with postcss?
Post-processor
There are a lot of benefits to using something like postcss. A lot of this stuff
is available to sass...but not all. If you want to use css next then you're using postcss

---

# Postcss

``` js
postcss: function() {
  return [
      autoprefixer
    , mqpacker
    , csswring
  ]
}
```

---

# Autoprefixer

``` css
.card-authors {
  display: flex;
  flex-grow: 1.25;
  flex-shrink: 0;
  align-items: center;
}
```
--

``` css
.card-authors {
  -webkit-flex: 1.25;
  -ms-flex: 1.25;
  flex: 1.25;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  -webkit-flex-shrink: 0;
  -ms-flex-negative: 0;
  flex-shrink: 0;
}
```

---

# Auto group media queries

``` css
.avatar { display: none; }

@media screen and (min-width: 42rem) {
  .avatar { display: flex; }
}

.button { flex: 1 0 100%; }

@media screen and (min-width: 42rem) {
  .button { flex: 1; }
}
```
--

``` css
.avatar { display: none; }
.button { flex: 1 0 100%; }

@media screen and (min-width: 42rem) {
  .avatar { display: flex; }
  .button { flex: 1; }
}
```

---

# Loads of plugins

https://github.com/postcss/postcss

---

class: center, middle

# Conclusion

---

class: center, middle

# Think about what you want to achieve and use tools that help you do that.

---

class: center, middle

# Focus on composition

---

# Thanks

https://github.com/keathley/webpack-react-skeleton
http://keathley.io/component_design/

### @ChrisKeathley / keathley@carbonfive.com / keathley.io


    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var slideshow = remark.create();
    </script>
  </body>
</html>
